const e=Symbol("system-observer-key"),t={Date:!0,Blob:!0,Number:!0,String:!0,Boolean:!0,Error:!0,SyntaxError:!0,TypeError:!0,URIError:!0,Function:!0,Promise:!0,RegExp:!0},r=function(e,t){let r=e.length;for(;r--;)try{e[r](t)}catch(t){console.error("failed to deliver changes to listener"+e[r],t)}},o="insert",n="update",l="delete",s="reverse",a="shuffle";class i extends Array{constructor(r,o){super(r.length);let n,l=r.length;for(this[e]=o;l--;)(n=r[l])&&"object"==typeof n&&!t.hasOwnProperty(n.constructor.name)?this[l]=new h({target:n,ownKey:l,parent:o}).proxy:this[l]=n}revoke(){this[e].revoke()}observe(t){let r=this[e],o=r.callbacks;if(r.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof t)throw new Error("observer (callback) parameter MUST be a function");o.indexOf(t)<0?o.push(t):console.info("observer (callback) may be bound to an observable only once")}unobserve(){let t,r,o=this[e],n=o.callbacks;if(o.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");if(t=arguments.length)for(;t--;)(r=n.indexOf(arguments[t]))>=0&&n.splice(r,1);else n.splice(0)}}class p{constructor(r,o){let n,l,s=Object.getOwnPropertyNames(r),a=s.length;for(this[e]=o;a--;)(l=r[n=s[a]])&&"object"==typeof l&&!t.hasOwnProperty(l.constructor.name)?this[n]=new h({target:l,ownKey:n,parent:o}).proxy:this[n]=l}revoke(){this[e].revoke()}observe(t){let r=this[e],o=r.callbacks;if(r.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof t)throw new Error("observer (callback) parameter MUST be a function");o.indexOf(t)<0?o.push(t):console.info("observer (callback) may be bound to an observable only once")}unobserve(){let t,r,o=this[e],n=o.callbacks;if(o.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");if(t=arguments.length)for(;t--;)(r=n.indexOf(arguments[t]))>=0&&n.splice(r,1);else n.splice(0)}}class h{constructor(e){null===e.parent&&(this.isRevoked=!1,this.callbacks=[]),this.parent=e.parent,this.ownKey=e.ownKey;let t,r=e.target,o=h.prototype;Array.isArray(r)?(t=new i(r,this),this.revokable=Proxy.revocable(t,{deleteProperty:o.proxiedDelete.bind(this),set:o.proxiedSet.bind(this),get:o.proxiedArrayGet.bind(this)})):(t=new p(r,this),this.revokable=Proxy.revocable(t,{deleteProperty:o.proxiedDelete.bind(this),set:o.proxiedSet.bind(this)})),this.proxy=this.revokable.proxy,this.target=t}revoke(){let t,r,o=this.target,n=Object.keys(o),l=n.length;for(this.revokable.revoke();l--;)if((r=o[t=n[l]])&&"object"==typeof r){let n=r[e];n&&(o[t]=n.revoke())}return o}unobserve(){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");let e=arguments.length;if(e)for(;e--;){let t=this.callbacks.indexOf(arguments[e]);t>=0&&this.callbacks.splice(t,1)}else this.callbacks.splice(0)}getPath(){let e,t,r=[],o=0,n=0,l=this;for(;null!==(e=l.ownKey);)r[o++]=e,l=l.parent;for(t=new Array(o);o--;)t[n++]=r[o];return t}getListeners(){let e=this;for(;e.parent;)e=e.parent;return e.callbacks}proxiedSet(l,s,a){let i,p,c,f=l[s];if(a&&"object"==typeof a&&!t.hasOwnProperty(a.constructor.name)?l[s]=new h({target:a,ownKey:s,parent:this}).proxy:l[s]=a,f&&"object"==typeof f){let t=f[e];t&&(f=t.revoke())}return(i=this.getListeners()).length&&((p=this.getPath()).push(s),r(i,c=void 0===f?[{type:o,path:p,value:a}]:[{type:n,path:p,value:a,oldValue:f}])),!0}proxiedDelete(t,o){let n,s,a,i=t[o];if(delete t[o]){if(i&&"object"==typeof i){let t=i[e];t&&(i=t.revoke())}return(n=this.getListeners()).length&&((s=this.getPath()).push(o),r(n,a=[{type:l,path:s,oldValue:i}])),!0}return!1}proxiedArrayGet(i,p){const c={pop:function(t,o){let n,s;if(n=t.length-1,(s=t.pop())&&"object"==typeof s){let t=s[e];t&&(s=t.revoke())}let a=o.getListeners();if(a.length){let e=o.getPath();e.push(n),r(a,[{type:l,path:e,oldValue:s}])}return s},push:function(e,n){let l,s,a,i,p,c,f=arguments.length-2,y=new Array(f),b=n.getListeners();for(p=e.length,b.length&&(c=n.getPath()),l=0;l<f;l++)(s=arguments[l+2])&&"object"==typeof s&&!t.hasOwnProperty(s.constructor.name)&&(s=new h({target:s,ownKey:p+l,parent:n}).proxy),y[l]=s;if(a=Reflect.apply(e.push,e,y),b.length){for(i=[],l=p,f=e.length;l<f;l++){let t=c.slice(0);t.push(l),i[l-p]={type:o,path:t,value:e[l]}}r(b,i)}return a},shift:function(t,o){let n,s,a,i,p,h,c;if((n=t.shift())&&"object"==typeof n){let t=n[e];t&&(n=t.revoke())}for(s=0,a=t.length;s<a;s++)if((i=t[s])&&"object"==typeof i){let t=i[e];t&&(t.ownKey=s)}return(p=o.getListeners()).length&&((h=o.getPath()).push(0),r(p,c=[{type:l,path:h,oldValue:n}])),n},unshift:function(n,l){let s,a,i,p=l.getListeners();(s=Array.from(arguments)).splice(0,2),s.forEach((e,r)=>{e&&"object"==typeof e&&!t.hasOwnProperty(e.constructor.name)&&(s[r]=new h({target:e,ownKey:r,parent:l}).proxy)}),a=Reflect.apply(n.unshift,n,s);for(let t,r=0,o=n.length;r<o;r++)if((t=n[r])&&"object"==typeof t){let o=t[e];o&&(o.ownKey=r)}if(p.length){let e,t=l.getPath(),a=s.length;i=new Array(a);for(let r=0;r<a;r++)(e=t.slice(0)).push(r),i[r]={type:o,path:e,value:n[r]};r(p,i)}return a},reverse:function(t,o){let n,l,a,i,p;for(t.reverse(),n=0,l=t.length;n<l;n++)if((a=t[n])&&"object"==typeof a){let t=a[e];t&&(t.ownKey=n)}return(i=o.getListeners()).length&&(p=[{type:s,path:o.getPath()}],r(i,p)),o.proxy},sort:function(t,o,n){let l,s,i,p,h;for(t.sort(n),l=0,s=t.length;l<s;l++)if((i=t[l])&&"object"==typeof i){let t=i[e];t&&(t.ownKey=l)}return(p=o.getListeners()).length&&(h=[{type:a,path:o.getPath()}],r(p,h)),o.proxy},fill:function(l,s){let a,i,p,c,f,y,b,u=s.getListeners(),v=[],g=l.length;(a=Array.from(arguments)).splice(0,2),p=(i=a.length)<2?0:a[1]<0?g+a[1]:a[1],c=i<3?g:a[2]<0?g+a[2]:a[2],f=l.slice(0),Reflect.apply(l.fill,l,a),u.length&&(y=s.getPath());for(let r,a,i=p;i<c;i++)if((r=l[i])&&"object"==typeof r&&!t.hasOwnProperty(r.constructor.name)&&(l[i]=new h({target:r,ownKey:i,parent:s}).proxy),f.hasOwnProperty(i)){if((a=f[i])&&"object"==typeof a){let t=a[e];t&&(a=t.revoke())}(b=y.slice(0)).push(i),v.push({type:n,path:b,value:l[i],oldValue:a})}else(b=y.slice(0)).push(i),v.push({type:o,path:b,value:l[i]});return u.length&&r(u,v),s.proxy},splice:function(s,a){let i,p,c,f,y,b,u,v,g,w,d=a.getListeners(),k=[],x=s.length;(i=Array.from(arguments)).splice(0,2),u=i.length;for(let e,r=2;r<u;r++)(e=i[r])&&"object"==typeof e&&!t.hasOwnProperty(e.constructor.name)&&(i[r]=new h({target:e,ownKey:r,parent:a}).proxy);f=0===u?0:i[0]<0?x+i[0]:i[0],y=u<2?x-f:i[1],b=Math.max(u-2,0),p=Reflect.apply(s.splice,s,i),x=s.length;for(let t,r=0;r<x;r++)(t=s[r])&&"object"==typeof t&&(c=t[e])&&(c.ownKey=r);for(v=0,g=p.length;v<g;v++)(w=p[v])&&"object"==typeof w&&(c=w[e])&&(p[v]=c.revoke());if(d.length){let e,t,i=a.getPath();for(e=0;e<y;e++)(t=i.slice(0)).push(f+e),e<b?k.push({type:n,path:t,value:s[f+e],oldValue:p[e]}):k.push({type:l,path:t,oldValue:p[e]});for(;e<b;e++)(t=i.slice(0)).push(f+e),k.push({type:o,path:t,value:s[f+e]});r(d,k)}return p}};return c.hasOwnProperty(p)?c[p].bind(void 0,i,this):i[p]}}class c{static from(e){if(!(!e||"object"!=typeof e||t.hasOwnProperty(e.constructor.name)||"observe"in e||"unobserve"in e||"revoke"in e)){return new h({target:e,ownKey:null,parent:null}).proxy}if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(t.hasOwnProperty(e.constructor.name))throw new Error(e+" found to be one of non-observable object types: "+t)}}Object.freeze(c);export default c;