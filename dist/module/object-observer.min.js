const e="insert",r="update",t="delete",o="reverse",n="shuffle",s=Symbol("system-observer-key"),p={Date:!0,Blob:!0,Number:!0,String:!0,Boolean:!0,Error:!0,SyntaxError:!0,TypeError:!0,URIError:!0,Function:!0,Promise:!0,RegExp:!0},a={revoke:{value:function(){this[s].revoke()}},observe:{value:function(e){let r=this[s],t=r.observers;if(r.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer parameter MUST be a function");t.indexOf(e)<0?t.push(e):console.info("observer may be bound to an observable only once")}},unobserve:{value:function(){let e,r,t=this[s],o=t.observers;if(t.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");if(e=arguments.length)for(;e--;)(r=o.indexOf(arguments[e]))>=0&&o.splice(r,1);else o.splice(0)}}},l=function(e,r){let t,o=e.length,n=new Array(e.length);for(n[s]=r;o--;)(t=e[o])&&"object"==typeof t&&!p.hasOwnProperty(t.constructor.name)?n[o]=Array.isArray(t)?new b({target:t,ownKey:o,parent:r}).proxy:new f({target:t,ownKey:o,parent:r}).proxy:n[o]=t;return n},y=function(e,r){let t,o,n=Object.keys(e),a=n.length,l={[s]:r};for(;a--;)(o=e[t=n[a]])&&"object"==typeof o&&!p.hasOwnProperty(o.constructor.name)?l[t]=Array.isArray(o)?new b({target:o,ownKey:t,parent:r}).proxy:new f({target:o,ownKey:t,parent:r}).proxy:l[t]=o;return l},h=function(e,r){let t=e.length;for(;t--;)try{e[t](r)}catch(r){console.error("failed to deliver changes to listener"+e[t],r)}},i=function(e){let r,t=[],o=0,n=0;for(;e.parent;)t[o++]=e.ownKey,e=e.parent;for(r=new Array(o);o--;)r[n++]=t[o];return{observers:e.observers,path:r}};class c{set(t,o,n){let a,l,y,c=t[o];if(a=n&&"object"==typeof n&&!p.hasOwnProperty(n.constructor.name)?Array.isArray(n)?new b({target:n,ownKey:o,parent:this}).proxy:new f({target:n,ownKey:o,parent:this}).proxy:n,t[o]=a,c&&"object"==typeof c){let e=c[s];e&&(c=e.revoke())}return(l=i(this)).observers.length&&(l.path.push(o),y=void 0===c?[{type:e,path:l.path,value:a,object:this.proxy}]:[{type:r,path:l.path,value:a,oldValue:c,object:this.proxy}],h(l.observers,y)),!0}deleteProperty(e,r){let o,n,p=e[r];if(delete e[r]){if(p&&"object"==typeof p){let e=p[s];e&&(p=e.revoke())}return(o=i(this)).observers.length&&(o.path.push(r),n=[{type:t,path:o.path,oldValue:p,object:this.proxy}],h(o.observers,n)),!0}return!1}}class b extends c{constructor(e){super();let r=e.target,t=l(r,this);null===e.parent?(this.isRevoked=!1,this.observers=[],Object.defineProperties(t,a)):(this.parent=e.parent,this.ownKey=e.ownKey),this.revokable=Proxy.revocable(t,this),this.proxy=this.revokable.proxy,this.target=t}revoke(){this.revokable.revoke();let e,r=this.target,t=r.length;for(;t--;)if((e=r[t])&&"object"==typeof e){let o=e[s];o&&(r[t]=o.revoke())}return r}get(a,l){const y={pop:function(e,r){let o,n;if(o=e.length-1,(n=e.pop())&&"object"==typeof n){let e=n[s];e&&(n=e.revoke())}let p=i(r);return p.observers.length&&(p.path.push(o),h(p.observers,[{type:t,path:p.path,oldValue:n,object:r.proxy}])),n},push:function(r,t){let o,n,s,a,l,y=arguments.length-2,c=new Array(y),u=i(t);for(l=r.length,o=0;o<y;o++)(n=arguments[o+2])&&"object"==typeof n&&!p.hasOwnProperty(n.constructor.name)&&(n=Array.isArray(n)?new b({target:n,ownKey:l+o,parent:t}).proxy:new f({target:n,ownKey:l+o,parent:t}).proxy),c[o]=n;if(s=Reflect.apply(r.push,r,c),u.observers.length){for(a=[],o=l,y=r.length;o<y;o++){let n=u.path.slice(0);n.push(o),a[o-l]={type:e,path:n,value:r[o],object:t.proxy}}h(u.observers,a)}return s},shift:function(e,r){let o,n,p,a,l,y;if((o=e.shift())&&"object"==typeof o){let e=o[s];e&&(o=e.revoke())}for(n=0,p=e.length;n<p;n++)if((a=e[n])&&"object"==typeof a){let e=a[s];e&&(e.ownKey=n)}return(l=i(r)).observers.length&&(l.path.push(0),y=[{type:t,path:l.path,oldValue:o,object:r.proxy}],h(l.observers,y)),o},unshift:function(r,t){let o,n,a,l;(o=Array.from(arguments)).splice(0,2),o.forEach((e,r)=>{e&&"object"==typeof e&&!p.hasOwnProperty(e.constructor.name)&&(o[r]=Array.isArray(e)?new b({target:e,ownKey:r,parent:t}).proxy:new f({target:e,ownKey:r,parent:t}).proxy)}),n=Reflect.apply(r.unshift,r,o);for(let e,t=0,o=r.length;t<o;t++)if((e=r[t])&&"object"==typeof e){let r=e[s];r&&(r.ownKey=t)}if((a=i(t)).observers.length){let n,s=o.length;l=new Array(s);for(let o=0;o<s;o++)(n=a.path.slice(0)).push(o),l[o]={type:e,path:n,value:r[o],object:t.proxy};h(a.observers,l)}return n},reverse:function(e,r){let t,n,p,a,l;for(e.reverse(),t=0,n=e.length;t<n;t++)if((p=e[t])&&"object"==typeof p){let e=p[s];e&&(e.ownKey=t)}return(a=i(r)).observers.length&&(l=[{type:o,path:a.path,object:r.proxy}],h(a.observers,l)),r.proxy},sort:function(e,r,t){let o,p,a,l,y;for(e.sort(t),o=0,p=e.length;o<p;o++)if((a=e[o])&&"object"==typeof a){let e=a[s];e&&(e.ownKey=o)}return(l=i(r)).observers.length&&(y=[{type:n,path:l.path,object:r.proxy}],h(l.observers,y)),r.proxy},fill:function(t,o){let n,a,l,y,c,u,v=i(o),w=[],g=t.length;(n=Array.from(arguments)).splice(0,2),l=(a=n.length)<2?0:n[1]<0?g+n[1]:n[1],y=a<3?g:n[2]<0?g+n[2]:n[2],c=t.slice(0),Reflect.apply(t.fill,t,n);for(let n,a,h=l;h<y;h++)if((n=t[h])&&"object"==typeof n&&!p.hasOwnProperty(n.constructor.name)&&(t[h]=Array.isArray(n)?new b({target:n,ownKey:h,parent:o}).proxy:new f({target:n,ownKey:h,parent:o}).proxy),c.hasOwnProperty(h)){if((a=c[h])&&"object"==typeof a){let e=a[s];e&&(a=e.revoke())}(u=v.path.slice(0)).push(h),w.push({type:r,path:u,value:t[h],oldValue:a,object:o.proxy})}else(u=v.path.slice(0)).push(h),w.push({type:e,path:u,value:t[h],object:o.proxy});return v.observers.length&&h(v.observers,w),o.proxy},splice:function(o,n){let a,l,y,c,u,v,w,g,x,j,d=i(n),k=[],A=o.length;(a=Array.from(arguments)).splice(0,2),w=a.length;for(let e,r=2;r<w;r++)(e=a[r])&&"object"==typeof e&&!p.hasOwnProperty(e.constructor.name)&&(a[r]=Array.isArray(e)?new b({target:e,ownKey:r,parent:n}).proxy:new f({target:e,ownKey:r,parent:n}).proxy);c=0===w?0:a[0]<0?A+a[0]:a[0],u=w<2?A-c:a[1],v=Math.max(w-2,0),l=Reflect.apply(o.splice,o,a),A=o.length;for(let e,r=0;r<A;r++)(e=o[r])&&"object"==typeof e&&(y=e[s])&&(y.ownKey=r);for(g=0,x=l.length;g<x;g++)(j=l[g])&&"object"==typeof j&&(y=j[s])&&(l[g]=y.revoke());if(d.observers.length){let s,p;for(s=0;s<u;s++)(p=d.path.slice(0)).push(c+s),s<v?k.push({type:r,path:p,value:o[c+s],oldValue:l[s],object:n.proxy}):k.push({type:t,path:p,oldValue:l[s],object:n.proxy});for(;s<v;s++)(p=d.path.slice(0)).push(c+s),k.push({type:e,path:p,value:o[c+s],object:n.proxy});h(d.observers,k)}return l}};return y.hasOwnProperty(l)?y[l].bind(void 0,a,this):a[l]}}class f extends c{constructor(e){super();let r=e.target,t=y(r,this);null===e.parent?(this.isRevoked=!1,this.observers=[],Object.defineProperties(t,a)):(this.parent=e.parent,this.ownKey=e.ownKey),this.revokable=Proxy.revocable(t,this),this.proxy=this.revokable.proxy,this.target=t}revoke(){this.revokable.revoke();let e,r,t=this.target,o=Object.keys(t),n=o.length;for(;n--;)if((r=t[e=o[n]])&&"object"==typeof r){let o=r[s];o&&(t[e]=o.revoke())}return t}}class u{constructor(){throw new Error('Observable MAY NOT be created via constructor, see "Observable.from" API')}static from(e){if(!(!e||"object"!=typeof e||p.hasOwnProperty(e.constructor.name)||"observe"in e||"unobserve"in e||"revoke"in e)){return(Array.isArray(e)?new b({target:e,ownKey:null,parent:null}):new f({target:e,ownKey:null,parent:null})).proxy}if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(p.hasOwnProperty(e.constructor.name))throw new Error(e+" found to be one of non-observable object types: "+p)}static isObservable(e){return!(!e||!e[s])}}Object.freeze(u);export default u;