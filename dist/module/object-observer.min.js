const e="insert",t="update",r="delete",o="reverse",n="shuffle",s=Symbol("system-observer-key"),a={Date:!0,Blob:!0,Number:!0,String:!0,Boolean:!0,Error:!0,SyntaxError:!0,TypeError:!0,URIError:!0,Function:!0,Promise:!0,RegExp:!0},l=function(e,t,r){let o,n=e.length;for(t[s]=r;n--;)(o=e[n])&&"object"==typeof o&&!a.hasOwnProperty(o.constructor.name)?t[n]=Array.isArray(o)?new i({target:o,ownKey:n,parent:r}).proxy:new f({target:o,ownKey:n,parent:r}).proxy:t[n]=o},p=function(e,t,r){let o,n,l=Object.keys(e),p=l.length;for(t[s]=r;p--;)(n=e[o=l[p]])&&"object"==typeof n&&!a.hasOwnProperty(n.constructor.name)?t[o]=Array.isArray(n)?new i({target:n,ownKey:o,parent:r}).proxy:new f({target:n,ownKey:o,parent:r}).proxy:t[o]=n},h=function(e,t){let r=e.length;for(;r--;)try{e[r](t)}catch(t){console.error("failed to deliver changes to listener"+e[r],t)}},y={revoke:{value:function(){this[s].revoke()}},observe:{value:function(e){let t=this[s],r=t.observers;if(t.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer parameter MUST be a function");r.indexOf(e)<0?r.push(e):console.info("observer may be bound to an observable only once")}},unobserve:{value:function(){let e,t,r=this[s],o=r.observers;if(r.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");if(e=arguments.length)for(;e--;)(t=o.indexOf(arguments[e]))>=0&&o.splice(t,1);else o.splice(0)}}};class i{constructor(e){let t=e.target,r=new Array(t.length);null===e.parent?(this.isRevoked=!1,this.observers=[],Object.defineProperties(r,y)):(this.parent=e.parent,this.ownKey=e.ownKey),l(t,r,this),this.revokable=Proxy.revocable(r,this),this.proxy=this.revokable.proxy,this.target=r}revoke(){this.revokable.revoke();let e,t=this.target,r=t.length;for(;r--;)if((e=t[r])&&"object"==typeof e){let o=e[s];o&&(t[r]=o.revoke())}return t}getPath(){let e,t=[],r=0,o=0,n=this;for(;n.parent;)t[r++]=n.ownKey,n=n.parent;for(e=new Array(r);r--;)e[o++]=t[r];return e}getObservers(){let e=this;for(;e.parent;)e=e.parent;return e.observers}get(l,p){const y={pop:function(e,t){let o,n;if(o=e.length-1,(n=e.pop())&&"object"==typeof n){let e=n[s];e&&(n=e.revoke())}let a=t.getObservers();if(a.length){let e=t.getPath();e.push(o),h(a,[{type:r,path:e,oldValue:n}])}return n},push:function(t,r){let o,n,s,l,p,y,u=arguments.length-2,c=new Array(u),b=r.getObservers();for(p=t.length,b.length&&(y=r.getPath()),o=0;o<u;o++)(n=arguments[o+2])&&"object"==typeof n&&!a.hasOwnProperty(n.constructor.name)&&(n=Array.isArray(n)?new i({target:n,ownKey:p+o,parent:r}).proxy:new f({target:n,ownKey:p+o,parent:r}).proxy),c[o]=n;if(s=Reflect.apply(t.push,t,c),b.length){for(l=[],o=p,u=t.length;o<u;o++){let r=y.slice(0);r.push(o),l[o-p]={type:e,path:r,value:t[o]}}h(b,l)}return s},shift:function(e,t){let o,n,a,l,p,y,i;if((o=e.shift())&&"object"==typeof o){let e=o[s];e&&(o=e.revoke())}for(n=0,a=e.length;n<a;n++)if((l=e[n])&&"object"==typeof l){let e=l[s];e&&(e.ownKey=n)}return(p=t.getObservers()).length&&((y=t.getPath()).push(0),h(p,i=[{type:r,path:y,oldValue:o}])),o},unshift:function(t,r){let o,n,l,p=r.getObservers();(o=Array.from(arguments)).splice(0,2),o.forEach((e,t)=>{e&&"object"==typeof e&&!a.hasOwnProperty(e.constructor.name)&&(o[t]=Array.isArray(e)?new i({target:e,ownKey:t,parent:r}).proxy:new f({target:e,ownKey:t,parent:r}).proxy)}),n=Reflect.apply(t.unshift,t,o);for(let e,r=0,o=t.length;r<o;r++)if((e=t[r])&&"object"==typeof e){let t=e[s];t&&(t.ownKey=r)}if(p.length){let n,s=r.getPath(),a=o.length;l=new Array(a);for(let r=0;r<a;r++)(n=s.slice(0)).push(r),l[r]={type:e,path:n,value:t[r]};h(p,l)}return n},reverse:function(e,t){let r,n,a,l,p;for(e.reverse(),r=0,n=e.length;r<n;r++)if((a=e[r])&&"object"==typeof a){let e=a[s];e&&(e.ownKey=r)}return(l=t.getObservers()).length&&(p=[{type:o,path:t.getPath()}],h(l,p)),t.proxy},sort:function(e,t,r){let o,a,l,p,y;for(e.sort(r),o=0,a=e.length;o<a;o++)if((l=e[o])&&"object"==typeof l){let e=l[s];e&&(e.ownKey=o)}return(p=t.getObservers()).length&&(y=[{type:n,path:t.getPath()}],h(p,y)),t.proxy},fill:function(r,o){let n,l,p,y,u,c,b,g=o.getObservers(),v=[],w=r.length;(n=Array.from(arguments)).splice(0,2),p=(l=n.length)<2?0:n[1]<0?w+n[1]:n[1],y=l<3?w:n[2]<0?w+n[2]:n[2],u=r.slice(0),Reflect.apply(r.fill,r,n),g.length&&(c=o.getPath());for(let n,l,h=p;h<y;h++)if((n=r[h])&&"object"==typeof n&&!a.hasOwnProperty(n.constructor.name)&&(r[h]=Array.isArray(n)?new i({target:n,ownKey:h,parent:o}).proxy:new f({target:n,ownKey:h,parent:o}).proxy),u.hasOwnProperty(h)){if((l=u[h])&&"object"==typeof l){let e=l[s];e&&(l=e.revoke())}(b=c.slice(0)).push(h),v.push({type:t,path:b,value:r[h],oldValue:l})}else(b=c.slice(0)).push(h),v.push({type:e,path:b,value:r[h]});return g.length&&h(g,v),o.proxy},splice:function(o,n){let l,p,y,u,c,b,g,v,w,O,d=n.getObservers(),k=[],j=o.length;(l=Array.from(arguments)).splice(0,2),g=l.length;for(let e,t=2;t<g;t++)(e=l[t])&&"object"==typeof e&&!a.hasOwnProperty(e.constructor.name)&&(l[t]=Array.isArray(e)?new i({target:e,ownKey:t,parent:n}).proxy:new f({target:e,ownKey:t,parent:n}).proxy);u=0===g?0:l[0]<0?j+l[0]:l[0],c=g<2?j-u:l[1],b=Math.max(g-2,0),p=Reflect.apply(o.splice,o,l),j=o.length;for(let e,t=0;t<j;t++)(e=o[t])&&"object"==typeof e&&(y=e[s])&&(y.ownKey=t);for(v=0,w=p.length;v<w;v++)(O=p[v])&&"object"==typeof O&&(y=O[s])&&(p[v]=y.revoke());if(d.length){let s,a,l=n.getPath();for(s=0;s<c;s++)(a=l.slice(0)).push(u+s),s<b?k.push({type:t,path:a,value:o[u+s],oldValue:p[s]}):k.push({type:r,path:a,oldValue:p[s]});for(;s<b;s++)(a=l.slice(0)).push(u+s),k.push({type:e,path:a,value:o[u+s]});h(d,k)}return p}};return y.hasOwnProperty(p)?y[p].bind(void 0,l,this):l[p]}set(r,o,n){let l,p,y,u=r[o];if(n&&"object"==typeof n&&!a.hasOwnProperty(n.constructor.name)?r[o]=Array.isArray(n)?new i({target:n,ownKey:o,parent:this}).proxy:new f({target:n,ownKey:o,parent:this}).proxy:r[o]=n,u&&"object"==typeof u){let e=u[s];e&&(u=e.revoke())}return(l=this.getObservers()).length&&((p=this.getPath()).push(o),h(l,y=void 0===u?[{type:e,path:p,value:n}]:[{type:t,path:p,value:n,oldValue:u}])),!0}deleteProperty(e,t){let o,n,a,l=e[t];if(delete e[t]){if(l&&"object"==typeof l){let e=l[s];e&&(l=e.revoke())}return(o=this.getObservers()).length&&((n=this.getPath()).push(t),h(o,a=[{type:r,path:n,oldValue:l}])),!0}return!1}}class f{constructor(e){let t=e.target,r={};null===e.parent?(this.isRevoked=!1,this.observers=[],Object.defineProperties(r,y)):(this.parent=e.parent,this.ownKey=e.ownKey),p(t,r,this),this.revokable=Proxy.revocable(r,this),this.proxy=this.revokable.proxy,this.target=r}revoke(){this.revokable.revoke();let e,t,r=this.target,o=Object.keys(r),n=o.length;for(;n--;)if((t=r[e=o[n]])&&"object"==typeof t){let o=t[s];o&&(r[e]=o.revoke())}return r}getPath(){let e,t=[],r=0,o=0,n=this;for(;n.parent;)t[r++]=n.ownKey,n=n.parent;for(e=new Array(r);r--;)e[o++]=t[r];return e}getObservers(){let e=this;for(;e.parent;)e=e.parent;return e.observers}set(r,o,n){let l,p,y,u=r[o];if(n&&"object"==typeof n&&!a.hasOwnProperty(n.constructor.name)?r[o]=Array.isArray(n)?new i({target:n,ownKey:o,parent:this}).proxy:new f({target:n,ownKey:o,parent:this}).proxy:r[o]=n,u&&"object"==typeof u){let e=u[s];e&&(u=e.revoke())}return(l=this.getObservers()).length&&((p=this.getPath()).push(o),h(l,y=void 0===u?[{type:e,path:p,value:n}]:[{type:t,path:p,value:n,oldValue:u}])),!0}deleteProperty(e,t){let o,n,a,l=e[t];if(delete e[t]){if(l&&"object"==typeof l){let e=l[s];e&&(l=e.revoke())}return(o=this.getObservers()).length&&((n=this.getPath()).push(t),h(o,a=[{type:r,path:n,oldValue:l}])),!0}return!1}}class u{static from(e){if(!(!e||"object"!=typeof e||a.hasOwnProperty(e.constructor.name)||"observe"in e||"unobserve"in e||"revoke"in e)){return(Array.isArray(e)?new i({target:e,ownKey:null,parent:null}):new f({target:e,ownKey:null,parent:null})).proxy}if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(a.hasOwnProperty(e.constructor.name))throw new Error(e+" found to be one of non-observable object types: "+a)}}Object.freeze(u);export default u;