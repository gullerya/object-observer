(()=>{"use strict";const e=this||window,t="insert",r="update",o="delete",n="reverse",s="shuffle",a=Symbol("system-observer-key"),p={Date:!0,Blob:!0,Number:!0,String:!0,Boolean:!0,Error:!0,SyntaxError:!0,TypeError:!0,URIError:!0,Function:!0,Promise:!0,RegExp:!0},l={revoke:{value:function(){this[a].revoke()}},observe:{value:function(e){let t=this[a],r=t.observers;if(t.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer parameter MUST be a function");r.indexOf(e)<0?r.push(e):console.info("observer may be bound to an observable only once")}},unobserve:{value:function(){let e,t,r=this[a],o=r.observers;if(r.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");if(e=arguments.length)for(;e--;)(t=o.indexOf(arguments[e]))>=0&&o.splice(t,1);else o.splice(0)}}},h=function(e,t,r){let o,n=e.length;for(t[a]=r;n--;)(o=e[n])&&"object"==typeof o&&!p.hasOwnProperty(o.constructor.name)?t[n]=Array.isArray(o)?new u({target:o,ownKey:n,parent:r}).proxy:new c({target:o,ownKey:n,parent:r}).proxy:t[n]=o},y=function(e,t,r){let o,n,s=Object.keys(e),l=s.length;for(t[a]=r;l--;)(n=e[o=s[l]])&&"object"==typeof n&&!p.hasOwnProperty(n.constructor.name)?t[o]=Array.isArray(n)?new u({target:n,ownKey:o,parent:r}).proxy:new c({target:n,ownKey:o,parent:r}).proxy:t[o]=n},i=function(e,t){let r=e.length;for(;r--;)try{e[r](t)}catch(t){console.error("failed to deliver changes to listener"+e[r],t)}},f=function(e){let t,r=[],o=0,n=0;for(;e.parent;)r[o++]=e.ownKey,e=e.parent;for(t=new Array(o);o--;)t[n++]=r[o];return{observers:e.observers,path:t}};class u{constructor(e){let t=e.target,r=new Array(t.length);null===e.parent?(this.isRevoked=!1,this.observers=[],Object.defineProperties(r,l)):(this.parent=e.parent,this.ownKey=e.ownKey),h(t,r,this),this.revokable=Proxy.revocable(r,this),this.proxy=this.revokable.proxy,this.target=r}revoke(){this.revokable.revoke();let e,t=this.target,r=t.length;for(;r--;)if((e=t[r])&&"object"==typeof e){let o=e[a];o&&(t[r]=o.revoke())}return t}get(e,l){const h={pop:function(e,t){let r,n;if(r=e.length-1,(n=e.pop())&&"object"==typeof n){let e=n[a];e&&(n=e.revoke())}let s=f(t);return s.observers.length&&(s.path.push(r),i(s.observers,[{type:o,path:s.path,oldValue:n}])),n},push:function(e,r){let o,n,s,a,l,h=arguments.length-2,y=new Array(h),b=f(r);for(l=e.length,o=0;o<h;o++)(n=arguments[o+2])&&"object"==typeof n&&!p.hasOwnProperty(n.constructor.name)&&(n=Array.isArray(n)?new u({target:n,ownKey:l+o,parent:r}).proxy:new c({target:n,ownKey:l+o,parent:r}).proxy),y[o]=n;if(s=Reflect.apply(e.push,e,y),b.observers.length){for(a=[],o=l,h=e.length;o<h;o++){let r=b.path.slice(0);r.push(o),a[o-l]={type:t,path:r,value:e[o]}}i(b.observers,a)}return s},shift:function(e,t){let r,n,s,p,l,h;if((r=e.shift())&&"object"==typeof r){let e=r[a];e&&(r=e.revoke())}for(n=0,s=e.length;n<s;n++)if((p=e[n])&&"object"==typeof p){let e=p[a];e&&(e.ownKey=n)}return(l=f(t)).observers.length&&(l.path.push(0),h=[{type:o,path:l.path,oldValue:r}],i(l.observers,h)),r},unshift:function(e,r){let o,n,s,l;(o=Array.from(arguments)).splice(0,2),o.forEach((e,t)=>{e&&"object"==typeof e&&!p.hasOwnProperty(e.constructor.name)&&(o[t]=Array.isArray(e)?new u({target:e,ownKey:t,parent:r}).proxy:new c({target:e,ownKey:t,parent:r}).proxy)}),n=Reflect.apply(e.unshift,e,o);for(let t,r=0,o=e.length;r<o;r++)if((t=e[r])&&"object"==typeof t){let e=t[a];e&&(e.ownKey=r)}if((s=f(r)).observers.length){let r,n=o.length;l=new Array(n);for(let o=0;o<n;o++)(r=s.path.slice(0)).push(o),l[o]={type:t,path:r,value:e[o]};i(s.observers,l)}return n},reverse:function(e,t){let r,o,s,p,l;for(e.reverse(),r=0,o=e.length;r<o;r++)if((s=e[r])&&"object"==typeof s){let e=s[a];e&&(e.ownKey=r)}return(p=f(t)).observers.length&&(l=[{type:n,path:p.path}],i(p.observers,l)),t.proxy},sort:function(e,t,r){let o,n,p,l,h;for(e.sort(r),o=0,n=e.length;o<n;o++)if((p=e[o])&&"object"==typeof p){let e=p[a];e&&(e.ownKey=o)}return(l=f(t)).observers.length&&(h=[{type:s,path:l.path}],i(l.observers,h)),t.proxy},fill:function(e,o){let n,s,l,h,y,b,v=f(o),w=[],g=e.length;(n=Array.from(arguments)).splice(0,2),l=(s=n.length)<2?0:n[1]<0?g+n[1]:n[1],h=s<3?g:n[2]<0?g+n[2]:n[2],y=e.slice(0),Reflect.apply(e.fill,e,n);for(let n,s,i=l;i<h;i++)if((n=e[i])&&"object"==typeof n&&!p.hasOwnProperty(n.constructor.name)&&(e[i]=Array.isArray(n)?new u({target:n,ownKey:i,parent:o}).proxy:new c({target:n,ownKey:i,parent:o}).proxy),y.hasOwnProperty(i)){if((s=y[i])&&"object"==typeof s){let e=s[a];e&&(s=e.revoke())}(b=v.path.slice(0)).push(i),w.push({type:r,path:b,value:e[i],oldValue:s})}else(b=v.path.slice(0)).push(i),w.push({type:t,path:b,value:e[i]});return v.observers.length&&i(v.observers,w),o.proxy},splice:function(e,n){let s,l,h,y,b,v,w,g,d,j,k=f(n),x=[],A=e.length;(s=Array.from(arguments)).splice(0,2),w=s.length;for(let e,t=2;t<w;t++)(e=s[t])&&"object"==typeof e&&!p.hasOwnProperty(e.constructor.name)&&(s[t]=Array.isArray(e)?new u({target:e,ownKey:t,parent:n}).proxy:new c({target:e,ownKey:t,parent:n}).proxy);y=0===w?0:s[0]<0?A+s[0]:s[0],b=w<2?A-y:s[1],v=Math.max(w-2,0),l=Reflect.apply(e.splice,e,s),A=e.length;for(let t,r=0;r<A;r++)(t=e[r])&&"object"==typeof t&&(h=t[a])&&(h.ownKey=r);for(g=0,d=l.length;g<d;g++)(j=l[g])&&"object"==typeof j&&(h=j[a])&&(l[g]=h.revoke());if(k.observers.length){let n,s;for(n=0;n<b;n++)(s=k.path.slice(0)).push(y+n),n<v?x.push({type:r,path:s,value:e[y+n],oldValue:l[n]}):x.push({type:o,path:s,oldValue:l[n]});for(;n<v;n++)(s=k.path.slice(0)).push(y+n),x.push({type:t,path:s,value:e[y+n]});i(k.observers,x)}return l}};return h.hasOwnProperty(l)?h[l].bind(void 0,e,this):e[l]}set(e,o,n){let s,l,h=e[o];if(n&&"object"==typeof n&&!p.hasOwnProperty(n.constructor.name)?e[o]=Array.isArray(n)?new u({target:n,ownKey:o,parent:this}).proxy:new c({target:n,ownKey:o,parent:this}).proxy:e[o]=n,h&&"object"==typeof h){let e=h[a];e&&(h=e.revoke())}return(s=f(this)).observers.length&&(s.path.push(o),l=void 0===h?[{type:t,path:s.path,value:n}]:[{type:r,path:s.path,value:n,oldValue:h}],i(s.observers,l)),!0}deleteProperty(e,t){let r,n,s=e[t];if(delete e[t]){if(s&&"object"==typeof s){let e=s[a];e&&(s=e.revoke())}return(r=f(this)).observers.length&&(r.path.push(t),n=[{type:o,path:r.path,oldValue:s}],i(r.observers,n)),!0}return!1}}class c{constructor(e){let t=e.target,r={};null===e.parent?(this.isRevoked=!1,this.observers=[],Object.defineProperties(r,l)):(this.parent=e.parent,this.ownKey=e.ownKey),y(t,r,this),this.revokable=Proxy.revocable(r,this),this.proxy=this.revokable.proxy,this.target=r}revoke(){this.revokable.revoke();let e,t,r=this.target,o=Object.keys(r),n=o.length;for(;n--;)if((t=r[e=o[n]])&&"object"==typeof t){let o=t[a];o&&(r[e]=o.revoke())}return r}set(e,o,n){let s,l,h=e[o];if(n&&"object"==typeof n&&!p.hasOwnProperty(n.constructor.name)?e[o]=Array.isArray(n)?new u({target:n,ownKey:o,parent:this}).proxy:new c({target:n,ownKey:o,parent:this}).proxy:e[o]=n,h&&"object"==typeof h){let e=h[a];e&&(h=e.revoke())}return(s=f(this)).observers.length&&(s.path.push(o),l=void 0===h?[{type:t,path:s.path,value:n}]:[{type:r,path:s.path,value:n,oldValue:h}],i(s.observers,l)),!0}deleteProperty(e,t){let r,n,s=e[t];if(delete e[t]){if(s&&"object"==typeof s){let e=s[a];e&&(s=e.revoke())}return(r=f(this)).observers.length&&(r.path.push(t),n=[{type:o,path:r.path,oldValue:s}],i(r.observers,n)),!0}return!1}}class b{static from(e){if(!(!e||"object"!=typeof e||p.hasOwnProperty(e.constructor.name)||"observe"in e||"unobserve"in e||"revoke"in e)){return(Array.isArray(e)?new u({target:e,ownKey:null,parent:null}):new c({target:e,ownKey:null,parent:null})).proxy}if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(p.hasOwnProperty(e.constructor.name))throw new Error(e+" found to be one of non-observable object types: "+p)}}Object.freeze(b),Object.defineProperty(e,"Observable",{value:b})})();