const e=Symbol("system-observer-key"),t={Date:!0,Blob:!0,Number:!0,String:!0,Boolean:!0,Error:!0,SyntaxError:!0,TypeError:!0,URIError:!0,Function:!0,Promise:!0,RegExp:!0},r=function(e,t){let r=e.length;for(;r--;)try{e[r](t)}catch(t){console.error("failed to deliver changes to listener"+e[r],t)}},o="insert",n="update",s="delete",l="reverse",a="shuffle";class i extends Array{constructor(r,o){super(r.length);let n,s=r.length;for(this[e]=o;s--;)(n=r[s])&&"object"==typeof n&&!t.hasOwnProperty(n.constructor.name)?this[s]=new h({target:n,ownKey:s,parent:o}).proxy:this[s]=n}revoke(){this[e].revoke()}observe(t){this[e].observe(t)}unobserve(){let t=this[e];t.unobserve.apply(t,arguments)}}class p{constructor(r,o){let n,s,l=Object.getOwnPropertyNames(r),a=l.length;for(this[e]=o;a--;)(s=r[n=l[a]])&&"object"==typeof s&&!t.hasOwnProperty(s.constructor.name)?this[n]=new h({target:s,ownKey:n,parent:o}).proxy:this[n]=s}revoke(){this[e].revoke()}observe(t){this[e].observe(t)}unobserve(){let t=this[e];t.unobserve.apply(t,arguments)}}class h{constructor(e){null===e.parent&&(this.isRevoked=!1,this.callbacks=[]),this.parent=e.parent,this.ownKey=e.ownKey;let t,r=e.target,o=h.prototype;Array.isArray(r)?(t=new i(r,this),this.revokable=Proxy.revocable(t,{deleteProperty:o.proxiedDelete.bind(this),set:o.proxiedSet.bind(this),get:o.proxiedArrayGet.bind(this)})):(t=new p(r,this),this.revokable=Proxy.revocable(t,{deleteProperty:o.proxiedDelete.bind(this),set:o.proxiedSet.bind(this)})),this.proxy=this.revokable.proxy,this.target=t}revoke(){let t,r,o=this.target,n=Object.keys(o),s=n.length;for(this.revokable.revoke();s--;)if((r=o[t=n[s]])&&"object"==typeof r){let n=r[e];n&&(o[t]=n.revoke())}return o}observe(e){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer (callback) parameter MUST be a function");this.callbacks.indexOf(e)<0?this.callbacks.push(e):console.info("observer (callback) may be bound to an observable only once")}unobserve(){if(this.isRevoked)throw new TypeError("revoked Observable MAY NOT be unobserved anymore");let e=arguments.length;if(e)for(;e--;){let t=this.callbacks.indexOf(arguments[e]);t>=0&&this.callbacks.splice(t,1)}else this.callbacks.splice(0)}getPath(){let e,t,r=[],o=0,n=0,s=this;for(;null!==(e=s.ownKey);)r[o++]=e,s=s.parent;for(t=new Array(o);o--;)t[n++]=r[o];return t}getListeners(){let e=this;for(;e.parent;)e=e.parent;return e.callbacks}proxiedSet(s,l,a){let i,p,c,y=s[l];if(a&&"object"==typeof a&&!t.hasOwnProperty(a.constructor.name)?s[l]=new h({target:a,ownKey:l,parent:this}).proxy:s[l]=a,y&&"object"==typeof y){let t=y[e];t&&(y=t.revoke())}return(i=this.getListeners()).length&&((p=this.getPath()).push(l),r(i,c=void 0===y?[{type:o,path:p,value:a}]:[{type:n,path:p,value:a,oldValue:y}])),!0}proxiedDelete(t,o){let n,l,a,i=t[o];if(delete t[o]){if(i&&"object"==typeof i){let t=i[e];t&&(i=t.revoke())}return(n=this.getListeners()).length&&((l=this.getPath()).push(o),r(n,a=[{type:s,path:l,oldValue:i}])),!0}return!1}proxiedArrayGet(i,p){const c={pop:function(t,o){let n,l;if(n=t.length-1,(l=t.pop())&&"object"==typeof l){let t=l[e];t&&(l=t.revoke())}let a=o.getListeners();if(a.length){let e=o.getPath();e.push(n),r(a,[{type:s,path:e,oldValue:l}])}return l},push:function(e,n){let s,l,a,i,p,c,y=arguments.length-2,f=new Array(y),u=n.getListeners();for(p=e.length,u.length&&(c=n.getPath()),s=0;s<y;s++)(l=arguments[s+2])&&"object"==typeof l&&!t.hasOwnProperty(l.constructor.name)&&(l=new h({target:l,ownKey:p+s,parent:n}).proxy),f[s]=l;if(a=Reflect.apply(e.push,e,f),u.length){for(i=[],s=p,y=e.length;s<y;s++){let t=c.slice(0);t.push(s),i[s-p]={type:o,path:t,value:e[s]}}r(u,i)}return a},shift:function(t,o){let n,l,a,i,p,h,c;if((n=t.shift())&&"object"==typeof n){let t=n[e];t&&(n=t.revoke())}for(l=0,a=t.length;l<a;l++)if((i=t[l])&&"object"==typeof i){let t=i[e];t&&(t.ownKey=l)}return(p=o.getListeners()).length&&((h=o.getPath()).push(0),r(p,c=[{type:s,path:h,oldValue:n}])),n},unshift:function(n,s){let l,a,i,p=s.getListeners();(l=Array.from(arguments)).splice(0,2),l.forEach((e,r)=>{e&&"object"==typeof e&&!t.hasOwnProperty(e.constructor.name)&&(l[r]=new h({target:e,ownKey:r,parent:s}).proxy)}),a=Reflect.apply(n.unshift,n,l);for(let t,r=0,o=n.length;r<o;r++)if((t=n[r])&&"object"==typeof t){let o=t[e];o&&(o.ownKey=r)}if(p.length){let e,t=s.getPath(),a=l.length;i=new Array(a);for(let r=0;r<a;r++)(e=t.slice(0)).push(r),i[r]={type:o,path:e,value:n[r]};r(p,i)}return a},reverse:function(t,o){let n,s,a,i,p;for(t.reverse(),n=0,s=t.length;n<s;n++)if((a=t[n])&&"object"==typeof a){let t=a[e];t&&(t.ownKey=n)}return(i=o.getListeners()).length&&(p=[{type:l,path:o.getPath()}],r(i,p)),o.proxy},sort:function(t,o,n){let s,l,i,p,h;for(t.sort(n),s=0,l=t.length;s<l;s++)if((i=t[s])&&"object"==typeof i){let t=i[e];t&&(t.ownKey=s)}return(p=o.getListeners()).length&&(h=[{type:a,path:o.getPath()}],r(p,h)),o.proxy},fill:function(s,l){let a,i,p,c,y,f,u,b=l.getListeners(),g=[],v=s.length;(a=Array.from(arguments)).splice(0,2),p=(i=a.length)<2?0:a[1]<0?v+a[1]:a[1],c=i<3?v:a[2]<0?v+a[2]:a[2],y=s.slice(0),Reflect.apply(s.fill,s,a),b.length&&(f=l.getPath());for(let r,a,i=p;i<c;i++)if((r=s[i])&&"object"==typeof r&&!t.hasOwnProperty(r.constructor.name)&&(s[i]=new h({target:r,ownKey:i,parent:l}).proxy),y.hasOwnProperty(i)){if((a=y[i])&&"object"==typeof a){let t=a[e];t&&(a=t.revoke())}(u=f.slice(0)).push(i),g.push({type:n,path:u,value:s[i],oldValue:a})}else(u=f.slice(0)).push(i),g.push({type:o,path:u,value:s[i]});return b.length&&r(b,g),l.proxy},splice:function(l,a){let i,p,c,y,f,u,b,g,v,w,d=a.getListeners(),k=[],x=l.length;(i=Array.from(arguments)).splice(0,2),b=i.length;for(let e,r=2;r<b;r++)(e=i[r])&&"object"==typeof e&&!t.hasOwnProperty(e.constructor.name)&&(i[r]=new h({target:e,ownKey:r,parent:a}).proxy);y=0===b?0:i[0]<0?x+i[0]:i[0],f=b<2?x-y:i[1],u=Math.max(b-2,0),p=Reflect.apply(l.splice,l,i),x=l.length;for(let t,r=0;r<x;r++)(t=l[r])&&"object"==typeof t&&(c=t[e])&&(c.ownKey=r);for(g=0,v=p.length;g<v;g++)(w=p[g])&&"object"==typeof w&&(c=w[e])&&(p[g]=c.revoke());if(d.length){let e,t,i=a.getPath();for(e=0;e<f;e++)(t=i.slice(0)).push(y+e),e<u?k.push({type:n,path:t,value:l[y+e],oldValue:p[e]}):k.push({type:s,path:t,oldValue:p[e]});for(;e<u;e++)(t=i.slice(0)).push(y+e),k.push({type:o,path:t,value:l[y+e]});r(d,k)}return p}};return c.hasOwnProperty(p)?c[p].bind(void 0,i,this):i[p]}}class c{static from(e){if(!(!e||"object"!=typeof e||t.hasOwnProperty(e.constructor.name)||"observe"in e||"unobserve"in e||"revoke"in e)){return new h({target:e,ownKey:null,parent:null}).proxy}if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(t.hasOwnProperty(e.constructor.name))throw new Error(e+" found to be one of non-observable object types: "+t)}}Object.freeze(c),module.exports=c;